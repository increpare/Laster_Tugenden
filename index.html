<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>UWOG</title>
	<style>



.quickshake {
    -webkit-animation: pulsateb 0.5s ease-out;
    /*-webkit-animation-iteration-count: once; */
    opacity: 0;
    float: right;
    position:absolute;
}
@-webkit-keyframes pulsateb {
    0% { 
        opacity: 1;
        transform: translate(0px, 0px);
        font-size: 100%;
    }
    50% { 
        opacity: 0.5;
        transform: translate(5px, -10px);
        font-size: 120%;
    }
    100% { 
        opacity: 0;
        transform: translate(10px, -20px);
        font-size: 100%;
    }
}

abbr {
text-decoration: none !important;
border-bottom: 0px !important;
}



.fadeout {
    -webkit-animation: pulsateb 0.5s ease-out;
    /*-webkit-animation-iteration-count: once; */
    opacity: 0;
    float: right;
    position:absolute;
}
@-webkit-keyframes pulsateb {
    0% { 
        opacity: 1;
        transform: translate(0px, 0px);
        font-size: 100%;
    }
    50% { 
        opacity: 0.5;
        transform: translate(5px, -10px);
        font-size: 120%;
    }
    100% { 
        opacity: 0;
        transform: translate(10px, -20px);
        font-size: 100%;
    }
}

.pulsate {
    -webkit-animation: pulsate 0.5s ease-out;
    -webkit-animation-iteration-count: infinite; 
    opacity: 0.5;
}
@-webkit-keyframes pulsate {
    0% { 
        opacity: .2;
        font-size: 100%;
    }
    50% { 
        opacity: 1;
        font-size: 120%;
    }
    100% { 
        opacity: .2;
        font-size: 100%;
    }
}
		ul{
			display :inline-block;
		}
		body {

		  max-width: 600px;
		  margin: auto;
		  padding-top: 10px;
		}
		h1{
			text-align: center;
		}
		table {
  			border-collapse: collapse;
		}
		table {
			border:none;
		}
		th, td {
		  border: 1px solid black;
		}
		td {
			width:100pt;
			text-align: center;
		}
		.oben {
			border-top: none;
		}
		.obenleft {
			/*border-left: none;*/
		}
		.obenright {
			/*border-right: none;*/
		}
		#reihe {
			font-weight: bold;
			text-align: center;
			font-size: 150%;

		}
		#ausgew√§hlt {
			font-weight: bold;
			text-align: center;
		}
		.tugend {	
			/*font-family: 'Playfair Display', serif;*/
			color:green;
		}
		.laster {
			/*font-family: 'UnifrakturMaguntia', cursive;*/
			color:red;
		}
		.unentschieden {
			/*font-family: 'UnifrakturMaguntia', cursive;*/
			/*color:gray;*/
			/*alpha:0.5;*/
			/*background-color: lightgray;*/
			opacity: 0.5;
		}
		.side {
			width:30pt;
		  	border-left: none;
		  	border-right: none;
		  	text-align: center;	
		}
		.emside {
			width:30pt;
			border:none;
		}
		.status {
			height:50pt;
		}
		.good {
			background-color: lightgreen;
		}
		.evil {
			background-color: pink;
		}
		.goodbad {			
			height:50pt;
			border:none;
			font-weight: bold;
			font-size: 200%;
		}
		.healtextclass {
			color:blue;
		}
		.damagetextclass {
			color:brown;
		}
		.invis {
			border:none;
		}
		#score {
			text-align: left;
			border:none;
			font-weight: none;
		}
		button {			
			/*border:none;*/
			font-weight: bold;
			font-size: 100%;
		}
		#goodbutton {
			background-color: lightgreen;
		}
		#badbutton {
			background-color: pink;
		}

		/*from w3schools*/

		/* Tooltip container */
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black; 
  /* If you want dots under the hoverable text */
}

/* Tooltip text */
.tooltip .tooltiptext {
font-weight: normal;
  visibility: hidden;
  width: 300px;
  background-color: #555;
  color: #fff;
  text-align: left;
  padding: 5px 5px;
  border-radius: 6px;

  /* Position the tooltip text */
  position: absolute;
  z-index: 1;
  bottom: 100%;
  left: 50%;
  margin-left: -60px;

  /* Fade in tooltip */
  opacity: 0;
  transition: opacity 0.3s;
}

/* Tooltip arrow */
.tooltip .tooltiptext::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 12%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: #555 transparent transparent transparent;
}

/* Show the tooltip text when you mouse over the tooltip container */
.tooltip:hover .tooltiptext {
  visibility: visible;
  opacity: 1;
  pointer-events: none;

}
	</style>
</head>
<body>
	<h1>UWOG</h1>
	<p>

<table id="haupttabelle">
		<tr>
		<td class="emside">
		</td>
		<td class="goodbad" colspan="2">
			<button type="button" id="goodbutton"  accesskey="s">Thou shalt </button>
		</td>
		<td class="goodbad"  colspan="2">
			<button type="button" id="badbutton"  accesskey="n">Thou shalt <u>not</u></button>
		</td>
		<td class="emside">
		</td>
	</tr>
		<tr>
		<td class="emside">
		</td>
		<td id="score">
			Score:<span id="scoretxt">0</span> (High:<span id="maxscore">0</span>)
		</td>
		<td class="invis">
		</td>
		<td class="invis">
		</td>
		<td class="invis">
		</td>
		<td class="emside">
		</td>
	</tr>

	<tr class="oben">
		<td class="emside">
		</td>
		<td id="r1c1" class="oben obenleft">‚ãÆ
		</td>
		<td id="r1c4" class="oben">‚ãÆ
		</td>
		<td id="r1c4" class="oben">‚ãÆ
		</td>
		<td id="r1c4" class="oben obenright">‚ãÆ
		</td>
		<td class="emside">
		</td>
	</tr>

</table>

<p>
	<button type="button" id="newgamebutton" >New Game</button>
	<p>
		<ul>
		<li>Being virtuous +1 health.
		<li>Not being virtuous -1 health.
		<li>Avoiding vices +1 health.
		<li>Committing vices -1 health.
		<li>People who have forsworn a crime will inflict -1 additional damage on perpetrators.
		<li>People who follow a particular virtue will punish those who neglect it with -1 damage.
		<li>People remember what you've told them. If they are in the same sitaution in future, they will automatically carry out the requested behaviour.
	</ul>
		(You can mouse hover over cells in the top 3 rows to find out what their effect will be).
<p>
	<center><a href="https://www.increpare.com">home</a></center>
	<p>
<script type="text/javascript">
	var state=[];

	var agent_zahl = 4;
	var gebot_zahl = 14;
	var vor_zeile_zahl = 2;

	var emoji = ['ü§°','ü§ñ','üí©','üëΩ'];
	var todemoji='üíÄ';
	var starthealth=4;


	var gutSchaltfl√§che;
	var b√∂seSchaltfl√§che;
	var neuSchaltfl√§che;


	// var tugenden = [
	// // 'Demut','Mildt√§tigkeit','Keuschheit','Geduld','M√§√üigung','Wohlwollen','Flei√ü'
	// // 'humilitas','caritas','castitas','patientia','temperantia','humanitas','industria'
	// ];
	// var laster = [
	// // 'Hochmut','Habgier','Wollust','Zorn','V√∂llerei','Neid','Faulheit'
	// ];

	var tugenden = ['Faith','Valour','Charity','Diligence','Patience','Kindness','Humility'];

	var laster = ['Murder','Bestiality','Sodomy','Theft','Stalking','Vulgarity','Rebellion'];
	var worte = tugenden.concat(laster);
	
	function getHighScore(){
		try {
			var storagedHighScore = localStorage.getItem("highscore");
			var highscore=0;
			if (storagedHighScore!=null){
				highscore=parseInt(storagedHighScore);
			}
			return highscore;
		} catch(e){
			return 0;
		}
	}
	function setHighScore(){
		try {
			var hs = getHighScore();
			if (hs<state.score){
				localStorage.setItem("highscore",state.score);
			}
		} catch(e){

		}
	}

	function tugendsein(w){
		return tugenden.indexOf(w)>=0;
	}

	function getWort(){
		return worte[Math.floor(Math.random()*worte.length)];
	}

	function befehlWert(agent,wort){
		// return (wort.length%3)-1;

		for (var i=0;i<gebot_zahl;i++){
			var gebot = state.gebote[agent][i];
			if (gebot.length===0){
				continue;
			}
			if (gebot[1]===0){
				continue;
			}
			if (gebot[0]==wort){
				return gebot[1];
			}
		}
		return 0;
	}

	function stellZustand(){

		document.getElementById("scoretxt").innerHTML=state.score;

		for (var i=0;i<agent_zahl;i++){
			var elem = document.getElementById('health'+i);
			if (state.healths[i]>0){
				if (state.healths[i]<3 &&!verloren()){
					elem.innerHTML=`${emoji[i]} <span class="pulsate">${state.healths[i]}</span>`;
				} else {
					elem.innerHTML=`${emoji[i]} ${state.healths[i]}`;										
				}

			} else {
				elem.innerHTML=todemoji+" "+ state.healths[i];
			}
			if (state.healths[i]!==state.oldhealths[i]){
				var delta = state.healths[i]-state.oldhealths[i];
				var deltas = ""+delta;
				if (delta>0){
					deltas = "+"+deltas;
				}
				elem.innerHTML+=`<span class="fadeout ${delta>0?"healtextclass":"damagetextclass"}">(${deltas})</span>`;
				state.oldhealths[i]=state.healths[i];
			}
		}

		for (var i=0;i<agent_zahl;i++){
			for (var j=0;j<vor_zeile_zahl;j++){
				var elem = document.getElementById(`v${j}c${i}`);
				var wort = state.vor[i][j];
				elem.innerHTML=h√ºllWort(wort,i);

				var wert = befehlWert(i,wort);
				switch(wert){
					case -1:
					elem.className="evil";
					break;
					case 0:
					elem.className="";
					break;
					case 1:
					elem.className="good";
					break;
				}
			}
		}

		for (var i=0;i<agent_zahl;i++){
			for (var j=0;j<gebot_zahl;j++){
				var elem = document.getElementById(`g${j}c${i}`);
				var gebot = state.gebote[i][j];
				if (gebot.length===0){
					elem.innerHTML="&nbsp;";
					elem.className="";
					continue;
				}
				var wert = befehlWert(i,gebot[0]);
				switch(wert){
					case -1:
					elem.className="gebotzelle evil";
					break;
					case 0:
					elem.className="gebotzelle unentschieden";
					break;
					case 1:
					elem.className="gebotzelle good";
					break;
				}
				elem.innerHTML=h√ºllWort(gebot[0],-1);
			}
		}

		// state.gebote=[];
		// for (var i=0;i<agent_zahl;i++){
		// 	state.gebote.push([]);
		// 	for (var j=0;j<gebot_zahl;j++){
		// 		state.gebote[i].push(getWort());
		// 	}
		// }

		// state.reihe=[];
		for (var i=0;i<agent_zahl;i++){
			var elem = document.getElementById(`agw${i}`);
			var wort = state.reihe[i];
			elem.innerHTML=h√ºllWort(wort,i);


				var wert = befehlWert(i,wort);
				switch(wert){
					case -1:
					elem.className="evil";
					break;
					case 0:
					elem.className="";
					break;
					case 1:
					elem.className="good";
					break;
				}

		// 	state.reihe.push(getWort());
		}

		if (verloren()){			
			gutSchaltfl√§che.disabled=true;
			b√∂seSchaltfl√§che.disabled=true;
			var hs = getHighScore();
			var text = `Game over.\nYour score was ${state.score} :)`;
			if (hs<state.score){
				text+="\nNew high score!";
			} else {
				text+=`\n(High Score : ${hs})`
			}

			alert(text);
			setHighScore(state.score);
		}
		document.getElementById("maxscore").innerHTML=getHighScore();
	}

	var highlightrow=-1;
	var highlightrow2=-1;
	var stylesheet = document.styleSheets[0];

	function vor_onmouseenter(zeile,agent){
		var wort = state.vor[agent][zeile];
		var wortindex = worte.indexOf(wort);
		highlightrow=stylesheet.insertRule(`.gebotrow${wortindex} .gebotzelle{ } `);
		highlightrow2=stylesheet.insertRule(`.gebotrow${wortindex} { border: 1px solid black; background-color:white; }`);
	}
	
	function vor_onmouseleave(agent,zeile){
		if (highlightrow>=0){
			stylesheet.deleteRule(highlightrow);
			stylesheet.deleteRule(highlightrow2);
			highlightrow=-1;
		}
	}


	function agw_onmouseenter(agent){

		var wort = state.reihe[agent];
		var wortindex = worte.indexOf(wort);
		highlightrow=stylesheet.insertRule(`.gebotrow${wortindex} .gebotzelle{ } `);
			highlightrow2=stylesheet.insertRule(`.gebotrow${wortindex} { border: 1px solid black; background-color:white; }`);
	}
	
	function agw_onmouseleave(i,j){
		if (highlightrow>=0){
			stylesheet.deleteRule(highlightrow);
			stylesheet.deleteRule(highlightrow2);
			highlightrow=-1;
		}
	}

	function generiereTabelle(){

		var table = document.getElementById('haupttabelle');

		state={};
		state.score=0;
		state.healths=[];
		state.oldhealths=[];
		for (var i=0;i<agent_zahl;i++){
			state.healths.push(starthealth);
			state.oldhealths.push(starthealth);
		}

		state.vor=[];
		for (var i=0;i<agent_zahl;i++){
			state.vor.push([]);
			for (var j=0;j<gebot_zahl;j++){
				state.vor[i].push(getWort());
			}
		}

		state.gebote=[];
		for (var i=0;i<agent_zahl;i++){
			state.gebote.push([]);
			for (var j=0;j<gebot_zahl;j++){
				state.gebote[i].push([worte[j],0]);
			}
		}

		state.reihe=[];
		for (var i=0;i<agent_zahl;i++){
			state.reihe.push(getWort());
		}

		var inner = "";

		for (var i=0;i<vor_zeile_zahl;i++){
			inner += `
	<tr>
		<td class="emside">
		</td>`

			for (var j=0;j<agent_zahl;j++){
				inner +=`<td  onmouseenter="vor_onmouseenter(${i},${j})" onmouseleave="vor_onmouseleave(${i},${j})" id="v${i}c${j}">
			platzhalter
		</td>`
			}

			inner +=`
		<td class="emside">
		</td>
	</tr>`

		}

		inner+= `
	<tr id="ausgew√§hlt">
		<td class="side">
			->
		</td>`


			for (var j=0;j<agent_zahl;j++){
				inner +=`<td  onmouseenter="agw_onmouseenter(${j})" onmouseleave="agw_onmouseleave(${i},${j})"  id="agw${j}">
			platzhalter
		</td>`
			}

		inner+=`
		<td class="side">
			&lt;-
		</td>
	</tr>`

		inner+=`
	<tr class="status" id ="reihe">
		<td class="emside">
		</td>`


			for (var j=0;j<agent_zahl;j++){
				inner +=`
		<td id="health${j}">
			666
		</td>`
			}


		inner+=`
		<td class="emside">
		</td>
	</tr>`


		for (var i=0;i<gebot_zahl;i++){
			inner += `
	<tr class="gebotrow${i}">
		<td class="emside">
		</td>`

			for (var j=0;j<agent_zahl;j++){
				inner +=`<td id="g${i}c${j}">
			platzhalter
		</td>`
			}

			inner +=`
		<td class="emside">
		</td>
	</tr>`

		}
		table.innerHTML +=  inner;
	}

	function sollAnimieren(){		
		if (verloren()){
			return false;
		}

		for (var i=0;i<agent_zahl;i++){
			var wort = state.reihe[i];
			if (befehlWert(i,wort)!==0){
				return true;
			}
		}
	}

	function tueTick(){
		for (var i=0;i<agent_zahl;i++){
			var wort = state.reihe[i];
			if (befehlWert(i,wort)!==0){
				var wert = befehlWert(i,wort);
				befehlSpalte(i,wert,false);
			}
		}

		if (voll()&& verloren()===false){
			state.score++;		
		}


		if (sollAnimieren()){
			fangMitAutoAn();
		} else {
			gutSchaltfl√§che.disabled=false;
			b√∂seSchaltfl√§che.disabled=false;
			neuSchaltfl√§che.disabled=false;
		}

		stellZustand();
	}

	function fangMitAutoAn(){
		gutSchaltfl√§che.disabled=true;
		b√∂seSchaltfl√§che.disabled=true;
		neuSchaltfl√§che.disabled=true;

		setTimeout(tueTick,500);
	}

	function verloren(){
		for (var i=0;i<agent_zahl;i++){
			if (state.healths[i]<=0){
				return true;
			}
		}
		return false;
	}

	function voll(){
		for (var i=0;i<agent_zahl;i++){
			for (var j=0;j<gebot_zahl;j++){
				if (state.gebote[i][j][1]===0){
					return false;
				}
			}
		}
		return true;
	}

	function befehl(wert){
		for (var i=0;i<agent_zahl;i++){
			befehlSpalte(i,wert,true);
		}
		
		if (sollAnimieren()){
			fangMitAutoAn();
		}

		if (!verloren()){
			state.score++;
		}
		stellZustand();
	}

	function befehlSpalte(agent,wert,hinzuf√ºgen){
		var i=agent;
		//1 bewege gebote hinunter

		// if (hinzuf√ºgen){
		// 	for (var j=gebot_zahl-1;j>=0;j--){
		// 		state.gebote[i][j+1]=state.gebote[i][j];
		// 	}
		// }

		//2 bewege die aktive Zeile hinunter + set wert

		var gebotzeil = worte.indexOf(state.reihe[i]);
		if (hinzuf√ºgen){
			state.gebote[i][gebotzeil][1]=wert;
		}

			var delta=0;
			if (tugendsein(state.reihe[i])){
				delta=wert;
			} else {
				delta=-wert;
			}

			{
				var wort = 	state.reihe[i];

				//for every other character
				for (var o=0;o<agent_zahl;o++){
					if (o===agent){
						continue;
					}

					var tugend = tugendsein(wort);
					var o_does = befehlWert(o,wort);
					
					 // if you fail to do something good that they value, they will punish you
					if (wert==-1 && tugend===true && o_does===1){
						delta-=1;
					}

					//if you do something evil that they are not allowed to do, they will punish you
					if (wert==1 && tugend===false && o_does===-1){
						delta-=1;
					}
				}
				state.healths[i]+=delta;
				if (state.healths[i]<0){
					state.healths[i]=0;
				}
			}

		//3 bewege die Vorschauzeile hinunter

			state.reihe[i]=state.vor[i][vor_zeile_zahl-1];


		//4 bewege Vorschauzeile hinunter

			for (var j=vor_zeile_zahl-1;j>=0;j--){
				state.vor[i][j+1]=state.vor[i][j];
			}

		//5 neuzeichnen

			state.vor[i][0]=getWort();


		//6 mit der animation anfangen, wenn relevant
	}

	function aufGutKlicken(){
		if (gutSchaltfl√§che.disabled){
			return;
		}
		befehl(1);
	}
	
	function aufB√∂seKlicken(){
		if (b√∂seSchaltfl√§che.disabled){
			return;
		}
		befehl(-1);
	}
	
	function aufNeuKlicken(){
		location.reload();
	}

	function signInt(i){
		if (i<0){
			return ""+i;
		} else {
			return "+"+i;
		}		
	}

	function h√ºllWort(w,agent,tooltiperlauben){
		var tugend = tugendsein(w);
		tooltiperlauben=false;//agent>=0;

		if (agent>=0){
			var delta=0;

			var disapproves=[];
			for (var o=0;o<agent_zahl;o++){
				if (o===agent){
					continue;
				}

				var o_does = befehlWert(o,w);
				
				 // if you fail to do something good that they value, they will punish you
				if (tugend===true && o_does===1){
					delta++;
					disapproves.push(emoji[o]);
				}

				//if you do something evil that they are not allowed to do, they will punish you
				if (tugend===false && o_does===-1){
					delta++;
					disapproves.push(emoji[o]);
				}
			}



			var wortindex = worte.indexOf(w);
			var compulsory = state.gebote[agent][wortindex][1];
			var tooltip="";

			var bigeffect = signInt(-1-disapproves.length)+` = -1 (${tugend?"virtue":"vice"})`;
			if (disapproves.length===1){
				bigeffect+=` -1 (${disapproves[0]} disapproves)`				
			} else if (disapproves.length>1){
				bigeffect += ` -${disapproves.length} (`
				for (var i=0;i<disapproves.length;i++){
					bigeffect+=disapproves[i];
				}
				bigeffect+=` disapprove)`
			}

			if (disapproves.length===0){
				bigeffect = `-1 (${tugend?"virtue":"vice"})`;
			}

			if (tugend){
				tooltip = "Do: +1 (virtue)\nDon't do: "+bigeffect;
			} else {
				tooltip = "Do: "+bigeffect+"\nDon't do: +1 (vice)";
			}


			// var tooltip=
			if (delta!==0){
				w+='<sup>';
				for (var i=0;i<delta;i++){
					w+='‚Ä†';
				}
				w+='</sup>';
			}

			if (tooltip.length>0){
				// w +=`<span class="tooltiptext">${tooltip}</span>`
				w=`<abbr title="${tooltip}">${w}</abbr>`
			}
		}

		if (tugend){
			w = `<span class="tugend ${(tooltiperlauben===true)?"tooltip":""}">${w}</span>`;
		} else {
			w = `<span class="laster ${(tooltiperlauben===true)?"tooltip":""}">${w}</span>`;
		} 

		return w; 
	}

	function schlie√üSchaltfl√§cheAn(){

		gutSchaltfl√§che = document.getElementById('goodbutton');
		b√∂seSchaltfl√§che = document.getElementById('badbutton');
		neuSchaltfl√§che = document.getElementById('newgamebutton');

		gutSchaltfl√§che.addEventListener("click", aufGutKlicken);
		b√∂seSchaltfl√§che.addEventListener("click", aufB√∂seKlicken);
		neuSchaltfl√§che.addEventListener("click", aufNeuKlicken);

	}


	generiereTabelle();
	stellZustand();
	schlie√üSchaltfl√§cheAn();

</script>
</body>
</html>